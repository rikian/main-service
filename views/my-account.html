<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>AdminLTE 3 | Dashboard 2</title>

        <!-- Google Font: Source Sans Pro -->
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
        <!-- Font Awesome Icons -->
        <link rel="stylesheet" href="{{.host_static}}/static/plugins/fontawesome-free/css/all.min.css">
        <!-- overlayScrollbars -->
        <link rel="stylesheet" href="{{.host_static}}/static/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
        <!-- Theme style -->
        <link rel="stylesheet" href="{{.host_static}}/static/dist/css/adminlte.min.css">
        <style>
            #body-master-product img{
                width: 50px;
            }
            .master-body-table{
                overflow: scroll;
            }
            .master-body-table::-webkit-scrollbar {
                width: 0;
            }
            input:-webkit-autofill,
            input:-webkit-autofill:hover, 
            input:-webkit-autofill:focus, 
            input:-webkit-autofill:active{
                -webkit-box-shadow: 0 0 0 30px rgb(42, 40, 40) inset !important;
            }

            #up_prev_product_image{
                width: 100%;
                margin-bottom: 10px;
                border-radius: 5px;
            }

            /* loading */
            .loading{
                display: none;
                width: 50px;
                height: 50px;
                border: 5px solid #ccc;
                border-top-color: #ff6a00;
                border-radius: 100%;

                position: fixed;
                left: 0;
                top: 0;
                right: 0;
                bottom: 0;
                margin: auto;
                z-index: 9999;

                animation: rotates 1s linear infinite;
            }

            @keyframes rotates{
                from{transform: rotate(0deg);}
                to{transform: rotate(360deg);}
            }

            /* master table */
            table#master_data{
                width: 1410px; 
                border: 1px solid gray; 
            }

            table#master_data th{
                border: 1px solid gray;
                text-align: center;
                background-color: #343a40;
            }

            table#master_data td{
                border: 1px solid gray;
                text-align: center;
            }
            
            table#master_data tr{
                background-color: #343a40;
            }
            
            table#master_data tr:hover{
                /* cursor: pointer; */
                background-color: #3f6791;
            }

            
            table#master_data .con-actions{
                display: flex;
                align-items: center;
                justify-content: center;
            }

            table#master_data button{
                height: 25px;
                margin: 5px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            /* av color scroll */
            .av-color{
                overflow: scroll;
            }
            .av-color::-webkit-scrollbar {
                width: 0;
            }
        </style>
    </head>

    <body class="hold-transition dark-mode sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">
        <div class="wrapper">
            <!-- Preloader -->
            <div class="preloader flex-column justify-content-center align-items-center">
                <img class="animation__wobble" src="{{.host_static}}/static/dist/img/AdminLTELogo.png" alt="AdminLTELogo" height="60" width="60">
            </div>

            <div class="loading"></div>

            <!-- Navbar -->
            <nav class="main-header navbar navbar-expand navbar-dark">
                <!-- head navbar links -->
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                    </li>
                    <li class="nav-item d-none d-sm-inline-block">
                        <a href="#" class="nav-link">Home</a>
                    </li>
                    <li class="nav-item d-none d-sm-inline-block">
                        <a target="_blank" href="/" class="nav-link">Market Place</a>
                    </li>
                    <li class="nav-item d-none d-sm-inline-block">
                        <a href="#" class="nav-link">My Order</a>
                    </li>
                    <li class="nav-item d-none d-sm-inline-block" style="cursor: pointer;">
                        <div id="btn-logout2" class="nav-link">Logout</div>
                    </li>
                </ul>

                <!-- Right navbar links -->
                <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" data-widget="fullscreen" href="#" role="button">
                    <i class="fas fa-expand-arrows-alt"></i>
                    </a>
                </li>
                </ul>
            </nav>
            <!-- /.navbar -->

            <!-- Main Sidebar Container -->
            <aside class="main-sidebar sidebar-dark-primary elevation-4">
                <!-- Brand Logo -->
                <a href="#" class="brand-link">
                    <img src="{{.host_static}}/static/dist/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8">
                    <span class="brand-text font-weight-light">LawnsoorLTE 3</span>
                </a>

                <!-- left Sidebar -->
                <div class="sidebar">
                    <!-- image user -->
                    <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                        <div class="image">
                            <img src="{{.host_static}}/static/dist/img/user2-160x160.jpg" class="img-circle elevation-2" alt="User Image">
                        </div>
                        <div class="info">
                            <a id="user-name" href="#" class="d-block"></a>
                        </div>
                    </div>

                    <!-- left menu -->
                    <nav class="mt-2">
                        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                            <!-- master data -->
                            <li class="nav-item">
                                <a id="button-master-data" href="#" class="nav-link active">
                                    <i class="nav-icon fas fa-chart-pie"></i>
                                    <p>
                                        Master Data
                                        <i class="right fas fa-angle-left"></i>
                                    </p>
                                </a>
                                <ul class="nav nav-treeview">
                                    <li id="add-product" class="nav-item">
                                        <a href="#" class="nav-link">
                                            <i class="far fa-circle nav-icon"></i>
                                            <p>Tambah Barang</p>
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="#" class="nav-link">
                                            <i class="far fa-circle nav-icon"></i>
                                            <p>History</p>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                            <!-- master profile -->
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <i class="nav-icon far fa-person-booth"></i>
                                    <p>Profile</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <!-- <a target="_blank" href="http://192.168.43.38:8080" class="nav-link"> -->
                                <a target="_blank" href="/" class="nav-link">
                                    <i class="nav-icon far fa-globe"></i>
                                    <p>Market Place</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <div id="btn-my-order" href="#" class="nav-link">
                                    <i class="nav-icon far fa-door-closed"></i>
                                    <p>My Order</p>
                                </div>
                            </li>
                            <li class="nav-item">
                                <div id="btn-logout1" href="#" class="nav-link">
                                    <i class="nav-icon far fa-door-closed"></i>
                                    <p>Logout</p>
                                </div>
                            </li>
                        </ul>
                    </nav>
                </div>
            </aside>

            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                <!-- Content Header -->
                <section class="content-header">
                    <div class="container-fluid">
                        <div class="row mb-2">
                            <div class="col-sm-6">
                                <h1>Master Data</h1>
                            </div>
                            <div class="col-sm-6">
                                <ol class="breadcrumb float-sm-right">
                                <li class="breadcrumb-item"><a href="#">Home</a></li>
                                <li class="breadcrumb-item active">Master Data</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- /.content-header -->

                <!-- style="border: 1px solid black;" -->

                <!-- Main content -->
                <section class="content">
                    <div class="container-fluid">
                        <!-- master data -->
                        <div id="container-master-data" class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">DataTable with default features</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="master-body-table">
                                            <table id="master_data">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 320px;">Product Id</th>
                                                        <th style="width: 300px;">Product Name</th>
                                                        <th style="width: 170px;">Product Price</th>
                                                        <th style="width: 170px;">Product Sell</th>
                                                        <th style="width: 170px;">Product Stock</th>
                                                        <th style="width: 300px;">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="body-master-product"></tbody>
                                                <tfoot>
                                                    <tr>
                                                        <th>Product Id</th>
                                                        <th>Product Name</th>
                                                        <th>Product Price</th>
                                                        <th>Product Sell</th>
                                                        <th>Product Stock</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- form add data to master -->
                        <div id="container-add-product" class="row">
                            <div class="col-md-6">
                                <div class="card card-primary">
                                    <div class="card-header">
                                        <h3 class="card-title">Tambah Produk</h3>
                                    </div>
                                    <form id="formDataProduct">
                                        <div class="card-body">
                                            <div class="mb-3">
                                                <label for="nama_produk">Nama Produk</label>
                                                <input name="product_name" type="text" class="form-control" id="nama_produk" placeholder="Nama Produk" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="harga_beli">Harga Beli</label>
                                                <input name="product_sell" type="number" class="form-control" id="harga_beli" placeholder="Harga Beli" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="harga_jual">Harga Jual</label>
                                                <input name="product_price" type="number" class="form-control" id="harga_jual" placeholder="Harga Jual" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="stock">Stok</label>
                                                <input name="product_stock" type="number" class="form-control" id="stock" placeholder="Stok" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="informasi_produk">Informasi Produk</label>
                                                <input name="product_info" type="text" class="form-control" id="informasi_produk" placeholder="Informasi Produk" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="gambar_barang">Gambar Produk</label>
                                                <div id="con-img-prev-add-product"></div>
                                                <div class="input-group">
                                                    <div class="custom-file">
                                                        <input id="product_image" type="file" class="custom-file-input" required>
                                                        <label class="custom-file-label" for="gambar_barang">Choose file</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- /.card-body -->
                                        <div class="card-footer">
                                            <button id="btn_add_new_product" class="btn btn-success">Kirim</button>
                                            <button id="btn_reset_add_new_product" type="reset" class="btn btn-warning">Reset</button>
                                            <button id="btn_close_add_new_product" class="btn btn-danger">Close</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- update data product -->
                        <div id="container-update-product" class="row">
                            <div class="col-md-6">
                                <div class="card card-primary">
                                    <div class="card-header">
                                        <h3 class="card-title">Update Produk</h3>
                                    </div>
                                    <form id="formUpdateDataProduct" enctype="multipart/form-data">
                                        <div class="card-body">
                                            <div id="con-img-prev-add-product">
                                                <img id="up_prev_product_image">
                                            </div>
                                            <div class="form-group">
                                                <label for="nama_produk">Product Id</label>
                                                <div id="up_product_id" class="form-control"></div>
                                            </div>
                                            <div class="form-group">
                                                <label for="nama_produk">Nama Produk</label>
                                                <input name="product_name" type="text" class="form-control" id="up_product_name" placeholder="Nama Produk" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="harga_beli">Harga Beli</label>
                                                <input name="product_sell" type="number" class="form-control" id="up_product_sell" placeholder="Harga Beli" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="harga_jual">Harga Jual</label>
                                                <input name="product_price" type="number" class="form-control" id="up_product_price" placeholder="Harga Jual" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="stock">Stok</label>
                                                <input name="product_stock" type="number" class="form-control" id="up_product_stock" placeholder="Stok" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="informasi_produk">Informasi Produk</label>
                                                <input name="product_info" type="text" class="form-control" id="up_product_info" placeholder="Informasi Produk" required>
                                            </div>
                                            <div style="display: none;">
                                                <label>URL Gambar Product</label>
                                                <div id="up_product_image" class="form-control" style="height: auto;"></div>
                                            </div>
                                        </div>
                                        <!-- /.card-body -->
                                        <div class="card-footer">
                                            <button id="btn_up_product" class="btn btn-primary">Kirim</button>
                                            <button id="btn_up_reset" type="reset" class="btn btn-primary">Reset</button>
                                            <button id="btn_up_close" class="btn btn-primary">Close</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- view product -->
                        <div id="container-view-product" class="row">
                            <div class="col-12 col-sm-6">
                                <!-- <h3 class="d-inline-block d-sm-none">LOWA Men’s Renegade GTX Mid Hiking Boots Review</h3> -->
                                <div class="col-12">
                                    <img id="view-image-product" src="" class="product-image" alt="Product Image">
                                </div>
                            </div>

                            <div class="col-12 col-sm-6">
                                <h3 id="view-name-product" class="my-3"></h3>
                                <div id="view-info-product"></div>
                                <hr>
                                <h4>Available Colors</h4>
                                <div class="av-color">
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-default text-center active">
                                            <input type="radio" name="color_option" id="color_option_a1" autocomplete="off" checked>Green
                                            <br>
                                            <i class="fas fa-circle fa-2x text-green"></i>
                                        </label>
                                        <label class="btn btn-default text-center">
                                            <input type="radio" name="color_option" id="color_option_a2" autocomplete="off">Blue
                                            <br>
                                            <i class="fas fa-circle fa-2x text-blue"></i>
                                        </label>
                                        <label class="btn btn-default text-center">
                                            <input type="radio" name="color_option" id="color_option_a3" autocomplete="off">Purple
                                            <br>
                                            <i class="fas fa-circle fa-2x text-purple"></i>
                                        </label>
                                        <label class="btn btn-default text-center">
                                            <input type="radio" name="color_option" id="color_option_a4" autocomplete="off">Red
                                            <br>
                                            <i class="fas fa-circle fa-2x text-red"></i>
                                        </label>
                                        <label class="btn btn-default text-center">
                                            <input type="radio" name="color_option" id="color_option_a5" autocomplete="off">Orange
                                            <br>
                                            <i class="fas fa-circle fa-2x text-orange"></i>
                                        </label>
                                    </div>
                                </div>
                    
                                <h4>Available Size</h4>
                                <div class="av-color">
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-default text-center">
                                            <input type="radio" name="color_option" id="color_option_b1" autocomplete="off">
                                            <span class="text-xl">S</span>
                                            <br>
                                            Small
                                        </label>
                                        <label class="btn btn-default text-center">
                                            <input type="radio" name="color_option" id="color_option_b2" autocomplete="off">
                                            <span class="text-xl">M</span>
                                            <br>
                                            Medium
                                        </label>
                                        <label class="btn btn-default text-center">
                                            <input type="radio" name="color_option" id="color_option_b3" autocomplete="off">
                                            <span class="text-xl">L</span>
                                            <br>
                                            Large
                                        </label>
                                        <label class="btn btn-default text-center">
                                            <input type="radio" name="color_option" id="color_option_b4" autocomplete="off">
                                            <span class="text-xl">XL</span>
                                            <br>
                                            Xtra-Large
                                        </label>
                                    </div>
                                </div>
                    
                                <div class="bg-gray py-2 px-3 mt-4">
                                    <h2 id="view-price-product" class="mb-0"></h2>
                                    <h4 class="mt-0"><small id="view-sell-product"></small></h4>
                                </div>

                                <button id="view-bact-to-master" class="btn btn-secondary" style="background-color:#3f6791; margin-top: 10px;">Back</button>
                            </div>
                        </div>

                        <!-- profile -->
                        <div class="row" style="display: none;">
                            <div class="col-md-6">
                                <div class="card card-primary">
                                    <!-- card-header -->
                                    <div class="card-header">
                                        <h3 class="card-title">Profile</h3>
                                    </div>
                                    <!-- form start -->
                                    <form>
                                        <div class="card-body">
                                            <img src="#" alt="image-preview">
                                            <div class="form-group">
                                                <label for="exampleInputEmail1">Nama Produk</label>
                                                <input type="text" class="form-control" id="exampleInputEmail1" placeholder="Nama Produk">
                                            </div>
                                            <div class="form-group">
                                                <label for="exampleInputEmail1">Harga Beli</label>
                                                <input type="number" class="form-control" id="exampleInputEmail1" placeholder="Harga Beli">
                                            </div>
                                            <div class="form-group">
                                                <label for="exampleInputEmail1">Harga Jual</label>
                                                <input type="number" class="form-control" id="exampleInputEmail1" placeholder="Harga Jual">
                                            </div>
                                            <div class="form-group">
                                                <label for="exampleInputEmail1">Stok</label>
                                                <input type="number" class="form-control" id="exampleInputEmail1" placeholder="Stok">
                                            </div>
                                            <div class="form-group">
                                                <label for="exampleInputPassword1">Informasi Produk</label>
                                                <input type="text" class="form-control" id="exampleInputPassword1" placeholder="Informasi Produk">
                                            </div>
                                            <div class="form-group">
                                                <label for="exampleInputFile">Gambar Produk</label>
                                                <div class="input-group">
                                                    <div class="custom-file">
                                                        <input type="file" class="custom-file-input" id="exampleInputFile">
                                                        <label class="custom-file-label" for="exampleInputFile">Choose file</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- /.card-body -->
                                        <div class="card-footer">
                                            <button type="submit" class="btn btn-primary">Kirim</button>
                                            <button type="reset" class="btn btn-primary">Reset</button>
                                            <button class="btn btn-primary">Cancel</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- order -->
                        <div id="container-my-order" class="row">
                            <div class="col-12 col-sm-6 col-md-3">
                                <div class="info-box">
                                    <span class="info-box-icon bg-info elevation-1"><i class="fas fa-cog"></i></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Orders</span>
                                        <span class="info-box-number">10</span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 col-sm-6 col-md-3">
                                <div class="info-box mb-3">
                                    <span class="info-box-icon bg-success elevation-1"><i class="fas fa-shopping-cart"></i></span>
                                        <div class="info-box-content">
                                        <span class="info-box-text">Success</span>
                                        <span class="info-box-number">760</span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 col-sm-6 col-md-3">
                                <div class="info-box mb-3">
                                    <span class="info-box-icon bg-warning elevation-1"><i class="fas fa-users"></i></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Pending</span>
                                        <span class="info-box-number">2,000</span>
                                    </div>
                                </div>
                            </div>
                            
                            
                            <!-- fix for small devices only -->
                            <div class="clearfix hidden-md-up"></div>
                            
                            <div class="col-12 col-sm-6 col-md-3">
                                <div class="info-box mb-3">
                                    <span class="info-box-icon bg-danger elevation-1"><i class="fas fa-thumbs-up"></i></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Failed</span>
                                        <span class="info-box-number">41,410</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- /.content -->
            </div>
            <!-- /.content-wrapper -->

            <!-- Control Sidebar -->
            <aside class="control-sidebar control-sidebar-dark">
                <!-- Control sidebar content goes here -->
            </aside>
        </div>
        <!-- CUSTOM SCRIPTS -->
        <script>
            "use strict"
            var host = {
                // host: "http://192.168.43.38",
                // origin: "http://192.168.43.38:8080"
                host: "http://127.0.0.1",
                origin: "http://127.0.0.1:8080"
            }

            var utils = {
                preImgAddProduct : new FileReader(),
                fr: new FileReader(),
                ce: function(elm) {
                    return document.createElement(elm)
                },
                qs: function(elm) {
                   return document.querySelector(elm)
                },
                parseToJSON: function(jsonString) {
                    try {
                        if (typeof jsonString !== "string") return false
                        return JSON.parse(jsonString)
                    } catch (error) {
                        console.error(error.message)
                        return false
                    }
                },
                jsonToString: function(jsonObj) {
                    try {
                        if (typeof jsonObj !== "object") return false
                        return JSON.stringify(jsonObj)
                    } catch (error) {
                        console.error(error.message)
                        return false
                    }
                },
                validationDataPostProduct: function(formPost) {
                    if (!formPost || typeof formPost !== "object") return alert("type form not valid")
                    // check data product
                    if (!formPost.get("product_name") || !formPost.get("product_sell") || !formPost.get("product_stock") || !formPost.get("product_info")) {
                        return false
                    }
                    alert("check data product")

                    return true
                },
                validationImage: function(dataImage) {
                    if (!dataImage || typeof dataImage !== "object" || !dataImage["size"] || typeof dataImage["size"] !== "number" || !dataImage["type"] || typeof dataImage["type"] !== "string" || !dataImage["type"].match("/")) {
                        alert("image not valid")
                        return false
                    }

                    if (dataImage["size"] > 100000) {
                        alert("image too large! receive : " + dataImage["size"])
                        return false
                    }

                    switch (dataImage["type"]) {
                        case "image/jpg":
                            return true
                        case "image/jpeg":
                            return true
                        case "image/png":
                            return true
                        default:
                            alert("type image not valid. receive : " + dataImage["type"])
                            return false                        
                    }
                }
            }

            var ajax = {
                xmlDelete : new XMLHttpRequest(),
                xmlUpdate : new XMLHttpRequest(),
                xmlGet : new XMLHttpRequest(),
                xmlPut : new XMLHttpRequest(),
                xmlPost : new XMLHttpRequest(),
                xmlLogout : new XMLHttpRequest(),
                loadData: function() {
                    html.openLoading()
                    var graphQuery = JSON.stringify({
                        query : "query{user {user{user_id user_email user_name user_image user_status created_date last_update products {UserId ProductId ProductName ProductImage ProductInfo ProductSell ProductStock ProductPrice CreatedDate LastUpdate}}code status}}"
                    })
                    this.xmlGet.open("POST", window.origin + "/service/my-account/data/all/", true);
                    this.xmlGet.setRequestHeader("content-type", "application/json")
                    return this.xmlGet.send(graphQuery);
                },
                deleteProduct: function(id, img) {
                    // check data product in database
                    var dataProduct = database.product(id)
                    if (!dataProduct) {
                        return alert("data not found")
                    }
                    var dataxml = "product_id" + "=" + dataProduct["ProductId"]
                    this.xmlDelete.open("DELETE", window.origin + "/account/data/products/product/" + dataProduct["ProductId"], true)
                    this.xmlDelete.setRequestHeader("content-type", "application/x-www-form-urlencoded")
                    this.xmlDelete.send()
                    return
                },
                updateProduct: function(id) {
                    // this.productId.innerText = ""
                    // this.btnResetUpdateProduct.click()
                    // var product = database.product(id)
                    // this.productId.innerText = product["ProductId"]
                    // this.productName.value = product["ProductName"]
                    // this.productSell.value = product["ProductSell"]
                    // this.productPrice.value = product["ProductPrice"]
                    // this.productStock.value = product["ProductStock"]
                    // this.productInfo.value = product["ProductInfo"]
                    // this.productImage.innerText = product["ProductImage"]
                },
                logout: function() {
                    this.xmlLogout.open("PUT", window.location.origin + "/user/logout/", true)
                    return this.xmlLogout.send()
                }
            }

            var database = {
                products: [],
                product: function(id) {
                    var product = false
                    for(var i =0; i < this.products.length; i++) {
                        if (this.products[i]["ProductId"] === id) {
                            product = this.products[i]
                            return product
                        }
                    }

                    return product
                },
                updateProduct: function(dataProduct) {
                    for (var i = 0; i < this.products.length; i++) {
                        if (this.products[i]["ProductId"] === dataProduct["ProductId"]) {
                            this.products[i]["ProductInfo"] = dataProduct["ProductInfo"]
                            this.products[i]["ProductName"] = dataProduct["ProductName"]
                            this.products[i]["ProductPrice"] = dataProduct["ProductPrice"]
                            this.products[i]["ProductSell"] = dataProduct["ProductSell"]
                            this.products[i]["ProductStock"] = dataProduct["ProductStock"]
                            this.products[i]["CreatedDate"] = dataProduct["CreatedDate"]
                            this.products[i]["LastUpdate"] = dataProduct["LastUpdate"]
                            break
                        }
                        
                    }
                },
                insertProduct: function(dataProduct) {
                    if (typeof dataProduct !== "object") {
                        alert("failed insert data product to master")
                        return false
                    }

                    this.products.push(dataProduct)
                    return true
                }
            }

            var profile = {
                userName: utils.qs("#user-name")
            }

            var html = {
                // loading
                loading: utils.qs(".loading"),
                // img preview add product
                conImgPrevAddProduct: utils.qs("#con-img-prev-add-product"),
                imgAddProduct: utils.qs("#product_image"),

                buttonMasterData: utils.qs("#button-master-data"),

                // container master data
                containerMasterData: utils.qs("#container-master-data"),

                // master body product
                masterBodyProduct: utils.qs("#body-master-product"),

                // form post new product
                formPostNewDataProduct: utils.qs("#formDataProduct"),
                btnSendPostNewDataProduct: utils.qs("#btn_add_new_product"),

                // form update product
                formUpdateDataProduct: utils.qs("#formUpdateDataProduct"),
                productImagePreview: utils.qs("#up_prev_product_image"),
                productId: utils.qs("#up_product_id"),
                productName: utils.qs("#up_product_name"),
                productSell: utils.qs("#up_product_sell"),
                productPrice: utils.qs("#up_product_price"),
                productStock: utils.qs("#up_product_stock"),
                productInfo: utils.qs("#up_product_info"),
                productImage: utils.qs("#up_product_image"),

                btnResetFormUpdateProduct: utils.qs("#btn_up_reset"),
                btnSendUpdateProduct: utils.qs("#btn_up_product"),
                btnCloseUpdate: utils.qs("#btn_up_close"),

                // action add product
                buttonAddProduct: utils.qs("#add-product"),
                formAddProduct: utils.qs("#container-add-product"),
                btnResetAddNewProduct: utils.qs("#btn_reset_add_new_product"),
                btnCloseAddNewProduct: utils.qs("#btn_close_add_new_product"),

                // action update product
                containerUpdateProduct: utils.qs("#container-update-product"),

                // action for view listener
                containerView: utils.qs("#container-view-product"),
                _productName: utils.qs("#view-name-product"),
                _productInfo: utils.qs("#view-info-product"),
                _productImage: utils.qs("#view-image-product"),
                _productPrice: utils.qs("#view-price-product"),
                _productSell: utils.qs("#view-sell-product"),
                _viewBactToMaster: utils.qs("#view-bact-to-master"),

                // logout
                btnLogout1: utils.qs("#btn-logout1"),
                btnLogout2: utils.qs("#btn-logout2"),

                // order
                btnMyOrder: utils.qs("#btn-my-order"),
                containerMyOrder: utils.qs("#container-my-order"),
                
                resetDataAddProduct: function() {
                    this.btnResetAddNewProduct.click()
                    this.conImgPrevAddProduct.innerHTML = ""
                },

                createContainerProduct: function(dataProduct) {
                    "use strict"
                    var containerProduct = utils.ce("tr")
                    containerProduct.setAttribute("id", "up" + dataProduct["ProductId"])
                    
                    var productId = utils.ce("td")
                    productId.innerText = dataProduct["ProductId"]
                    containerProduct.appendChild(productId)

                    var productName = utils.ce("td")
                    productName.innerText = dataProduct["ProductName"]
                    containerProduct.appendChild(productName)
                    
                    // var productImage = utils.ce("td")
                    // containerProduct.appendChild(productImage)

                    // var imgProduct = utils.ce("img")
                    // imgProduct.src = "http://localhost/cdn-lawnsoor/media/image-product/" + dataProduct["ProductImage"]
                    // imgProduct.setAttribute("loading", "lazy")
                    // productImage.appendChild(imgProduct)
                    
                    var productPrice = utils.ce("td")
                    productPrice.innerText = dataProduct["ProductPrice"]
                    containerProduct.appendChild(productPrice)
                    
                    var productSell = utils.ce("td")
                    productSell.innerText = dataProduct["ProductSell"]
                    containerProduct.appendChild(productSell)
                    
                    var productStock = utils.ce("td")
                    productStock.innerText = dataProduct["ProductStock"]
                    containerProduct.appendChild(productStock)

                    // var productInfo = utils.ce("td")
                    // productInfo.innerText = dataProduct["ProductInfo"]
                    // containerProduct.appendChild(productInfo)
                    
                    // var createdDate = utils.ce("td")
                    // createdDate.innerText = dataProduct["CreatedDate"]
                    // containerProduct.appendChild(createdDate)
                    
                    // var lastUpdate = utils.ce("td")
                    // lastUpdate.innerText = dataProduct["LastUpdate"]
                    // containerProduct.appendChild(lastUpdate)
                    
                    var actions = utils.ce("td")
                    actions.setAttribute("class", "con-actions")
                    containerProduct.appendChild(actions)

                    var buttonViewAction = utils.ce("button")
                    buttonViewAction.setAttribute("class", "btn btn-success")
                    buttonViewAction.innerText = "View"
                    buttonViewAction.addEventListener("click", function() {
                        return html.openContainerViewProduct(dataProduct)
                    })
                    actions.appendChild(buttonViewAction)
                    
                    var buttonUpdateAction = utils.ce("button")
                    buttonUpdateAction.setAttribute("class", "btn btn-warning")
                    buttonUpdateAction.innerText = "Update"
                    buttonUpdateAction.addEventListener("click", function() {
                        html.openContainerUpdateProduct()
                        return html.openFormUpdateProduct(dataProduct["ProductId"])
                    })

                    actions.appendChild(buttonUpdateAction)

                    var buttonDeleteAction = utils.ce("button")
                    buttonDeleteAction.setAttribute("class", "btn btn-danger")
                    buttonDeleteAction.innerText = "Delete"
                    actions.appendChild(buttonDeleteAction)

                    buttonDeleteAction.addEventListener("click", function() {
                        var confirm = prompt("Perhatian! Data yang dihapus tidak dapat dikembalikan!\n\nketik 'yes' untuk melanjutkan")
                        if (confirm !== "yes") return
                        return ajax.deleteProduct(dataProduct["ProductId"], dataProduct["ProductImage"])
                    })
                    
                    return containerProduct
                },
                
                openFormUpdateProduct: function(id) {
                    "use strict"
                    this.productId.innerText = ""
                    this.productImage.innerText = ""
                    this.btnResetFormUpdateProduct.click()
                    
                    var dataProduct = database.product(id)
                    
                    if (!dataProduct) return alert("data product not found")
                    this.productImagePreview.src = "http://localhost:9095" + "/cdn-lawnsoor/media/image-product/" + dataProduct["ProductImage"]
                    this.productId.innerText = dataProduct["ProductId"]
                    this.productName.value = dataProduct["ProductName"]
                    this.productSell.value = dataProduct["ProductSell"]
                    this.productPrice.value = dataProduct["ProductPrice"]
                    this.productStock.value = dataProduct["ProductStock"]
                    this.productInfo.value = dataProduct["ProductInfo"]
                    this.productImage.innerText = dataProduct["ProductImage"]
                    return
                },
                
                openFormAddProduct: function() {
                    this.containerMasterData.style.display = "none"
                    this.formAddProduct.style.display = "block"
                    this.containerUpdateProduct.style.display = "none"
                    this.containerView.style.display = "none"
                    this.containerMyOrder.style.display = "none"
                    return
                },
                
                openMasterData: function() {
                    this.containerMasterData.style.display = "block"
                    this.formAddProduct.style.display = "none"
                    this.containerUpdateProduct.style.display = "none"
                    this.containerView.style.display = "none"
                    this.containerMyOrder.style.display = "none"
                    return
                },
                
                openContainerUpdateProduct: function() {
                    this.containerUpdateProduct.style.display = "block"
                    this.formAddProduct.style.display = "none"
                    this.containerMasterData.style.display = "none"
                    this.containerView.style.display = "none"
                },
                
                openContainerViewProduct: function(dataProduct) {
                    this.containerView.style.display = "flex"
                    this.containerUpdateProduct.style.display = "none"
                    this.formAddProduct.style.display = "none"
                    this.containerMasterData.style.display = "none"
                    return this.passingDataToContainerProduct(dataProduct)
                },
                
                openContainerMyOrder: function() {
                    this.containerMasterData.style.display = "none"
                    this.formAddProduct.style.display = "none"
                    this.containerUpdateProduct.style.display = "none"
                    this.containerView.style.display = "none"
                    this.containerMyOrder.style.display = "flex"
                },

                passingDataToContainerProduct: function(dataProduct, userId) {
                    this._productName.innerText = dataProduct["ProductName"]
                    this._productInfo.innerText = dataProduct["ProductInfo"]
                    this._productPrice.innerText = "Rp. " + dataProduct["ProductPrice"].toLocaleString("id-ID") + ",-"
                    this._productSell.innerText = "Rp. " + dataProduct["ProductSell"].toLocaleString("id-ID") + ",-"
                    var imgParts = dataProduct["ProductImage"].split("/")
                    // this._productImage.src = host.origin + "/cdn-lawnsoor/media/image-product/" + dataProduct["ProductImage"]
                    this._productImage.src = "http://127.0.0.1:9095/cdn-lawnsoor/media/image-product/" + dataProduct["ProductImage"]
                },
                
                clearContainerView: function() {
                    this._productName.innerText = ""
                    this._productInfo.innerText = ""
                    this._productImage.src = ""
                    this._productPrice.innerText = ""
                    this._productSell.innerText = ""
                },
                
                openLoading: function() {
                    this.loading.style.display = "block"
                },
                
                closeLoading: function() {
                    this.loading.style.display = "none"
                }
            }

            html.formAddProduct.style.display = "none"
            html.containerUpdateProduct.style.display = "none"
            html.containerView.style.display = "none"
            html.containerMyOrder.style.display = "none"

            // request
            var request = {
                getDataUser: new XMLHttpRequest(),
                updateDataProduct: new XMLHttpRequest(),
                dataUser: function() {
                    html.openLoading()
                    var graphQuery = utils.jsonToString({
                        query : "query{user{user_id user_email user_name user_image user_status created_date last_update products {UserId ProductId ProductName ProductImage ProductInfo ProductSell ProductStock ProductPrice CreatedDate LastUpdate}}}"
                    })
                    
                    if (!graphQuery) {
                        alert("query graphql not valid")
                        return html.closeLoading()
                    }

                    this.getDataUser.open("POST", window.origin + "/account/data/all/", true);
                    this.getDataUser.setRequestHeader("content-type", "application/json")
                    return this.getDataUser.send(graphQuery);
                },
            }

            request.dataUser()

            // response get data user
            request.getDataUser.addEventListener("load", function() {
                var response = utils.parseToJSON(this.responseText)
                if (!response) {
                    html.closeLoading()
                    return alert("data not found")
                }

                profile.userName.innerText = response["data"]["user"]["user_name"]
                
                var dataProducts = response["data"]["user"]["products"]

                if (dataProducts === null || !dataProducts) {
                    html.closeLoading()
                    return
                }

                database.products = dataProducts

                for (var i = 0; i < dataProducts.length; i++) {
                    html.masterBodyProduct.appendChild(html.createContainerProduct(dataProducts[i]))
                }

                html.closeLoading()
            })

            // update event
            html.btnSendUpdateProduct.addEventListener("click", function(e) {
                e.preventDefault()
                // check data product exist or not in database
                var product = database.product(html.productId.innerText)
                if (!product) return alert("product not valid")
                var dataProduct = new FormData(html.formUpdateDataProduct)
                dataProduct.append("product_id", product["ProductId"])
                dataProduct.append("product_image", product["ProductImage"])
                dataProduct.append("created_date", product["CreatedDate"])
                ajax.xmlUpdate.open("PUT", window.location.origin + "/account/data/products/product/", true)
                ajax.xmlUpdate.send(dataProduct)
                console.log("processing update data product...")
                return
            })

            ajax.xmlUpdate.addEventListener("load", function(e) {
                var responseUpdateProduct = utils.parseToJSON(this.responseText)
                if (!responseUpdateProduct) return alert(this.responseText)
                var conProduct = utils.qs("#up" + responseUpdateProduct["product"]["ProductId"])
                if (!conProduct || conProduct === null) {
                    alert("container product not found")
                    return window.location.reload()
                }
                conProduct.remove()
                database.updateProduct(responseUpdateProduct["product"])
                html.masterBodyProduct.appendChild(html.createContainerProduct(responseUpdateProduct["product"]))
                alert("success update data product...")
                html.openMasterData()
                html.btnResetFormUpdateProduct.click()
                var cp = utils.qs("#up"+ responseUpdateProduct["product"]["ProductId"])
                cp.style.backgroundColor = "green"
                var borderTime = setTimeout(function() {
                    cp.style.backgroundColor = ""
                    return clearTimeout(borderTime)
                }, 3000)

                window.location = window.location.origin + "/#up" + responseUpdateProduct["product"]["ProductId"]
                return
            })

            html.btnCloseUpdate.addEventListener("click", function(e) {
                e.preventDefault()
                html.openMasterData()
            })

            html.btnMyOrder.addEventListener("click", function() {
                html.openContainerMyOrder()
            })

            html._viewBactToMaster.addEventListener("click", function() {
                // clear container view
                html.clearContainerView()
                html.openMasterData()
            })

            // action container add product
            html.btnCloseAddNewProduct.addEventListener("click", function(e) {
                e.preventDefault()
                html.openMasterData()
            })

            html.imgAddProduct.addEventListener("change", function() {
                if (!utils.validationImage(this.files[0])) {
                    return
                }

                html.conImgPrevAddProduct.innerHTML = ""

                utils.preImgAddProduct.readAsDataURL(this.files[0])
            })

            utils.preImgAddProduct.addEventListener("load", function() {
                var imgPrev = utils.ce("img")
                imgPrev.style.width = "100%"
                imgPrev.style.marginBottom = "10px"
                imgPrev.style.borderRadius = "5px"
                imgPrev.src = this.result
                html.conImgPrevAddProduct.appendChild(imgPrev)
            })

            html.btnResetAddNewProduct.addEventListener("click", function() {
                html.conImgPrevAddProduct.innerHTML = ""
            })

            html.buttonAddProduct.addEventListener("click", function() {
                html.openFormAddProduct()
            })

            // open master data
            html.buttonMasterData.addEventListener("click", function() {
                html.openMasterData()
            })

            // get all data
            // ajax.loadData()
            ajax.xmlGet.addEventListener("load", function() {
                var data = utils.parseToJSON(this.responseText)
                
                if (!data) {
                    html.closeLoading()
                    return alert("data not found")
                }
                
                profile.userName.innerText = data["data"]["user"]["user"]["user_name"]
                
                var dataProducts = data["data"]["user"]["user"]["products"]

                if (dataProducts === null || !dataProducts) {
                    html.closeLoading()
                    return
                }
                
                database.products = dataProducts

                for (var i = 0; i < dataProducts.length; i++) {
                    html.masterBodyProduct.appendChild(html.createContainerProduct(dataProducts[i]))
                }

                html.closeLoading()
                return console.log("load data finish...")
            })

            // post new data product
            var formNewProduct = null
            var formNewDataProduct = {
                name: utils.qs("#nama_produk"),
                buy: utils.qs("#harga_beli"),
                sell: utils.qs("#harga_jual"),
                stock: utils.qs("#stock"),
                info: utils.qs("#informasi_produk"),
            }

            function checkValue(elm) {
                try {
                    if (!elm.value || elm.value == null || elm.value === "") return false
                    return true
                } catch (error) {
                    console.log(error.message)
                    return false
                }
            }

            html.btnSendPostNewDataProduct.addEventListener("click", function(e) {
                e.preventDefault()
                html.openLoading()
                if (formNewProduct !== null) formNewProduct = null
                formNewProduct = new FormData(html.formPostNewDataProduct)
                if (!checkValue(formNewDataProduct.name) || !checkValue(formNewDataProduct.buy) || !checkValue(formNewDataProduct.sell) || !checkValue(formNewDataProduct.stock) || !checkValue(formNewDataProduct.info)) {
                    html.closeLoading()
                    return alert("data product not valid")
                }

                if (!html.imgAddProduct.files[0]) {
                    alert("please chooce image product")
                    return html.closeLoading()
                }

                return utils.fr.readAsArrayBuffer(html.imgAddProduct.files[0])
            })
            
            utils.fr.addEventListener("load", function(e) {
                var target = host.host + ":9095" + "/products/images/"
                // alert(target)
                ajax.xmlPost.open("POST", "http://" + window.location.hostname + ":9095/products/images/", true)
                ajax.xmlPost.withCredentials = true
                ajax.xmlPost.setRequestHeader("Content-Type", html.imgAddProduct.files[0].type)
                ajax.xmlPost.setRequestHeader("token", "image/jpeg")
                ajax.xmlPost.send(this.result)
                return
            })

            ajax.xmlPost.addEventListener("load", function(e) {
                var postMessage = utils.parseToJSON(this.responseText)
                if (!postMessage) return html.closeLoading()
                if (postMessage["method"] === "upload image") {
                    if (postMessage["status"] !== "ok") {
                        alert(postMessage["error"])
                        return html.closeLoading()
                    }
                    console.log(utils.parseToJSON(this.responseText))
                    formNewProduct.append("product_id", postMessage["productID"])
                    formNewProduct.append("enctype", "application/x-www-form-urlencoded")
                    ajax.xmlPost.open("POST", window.origin + "/account/data/products/product/", true)
                    ajax.xmlPost.send(formNewProduct)
                    return html.closeLoading()
                }

                if (postMessage["method"] === "add new product" && postMessage["status"] === "ok") {
                    console.log(postMessage)
                    if(!database.insertProduct(postMessage["info"])) {
                        html.closeLoading()
                        window.location.reload()
                        return 
                    }

                    html.masterBodyProduct.appendChild(html.createContainerProduct(postMessage["info"]))

                    html.closeLoading()
                    alert("success post product...")
                    
                    html.openMasterData()
                    html.resetDataAddProduct()

                    var cp = utils.qs("#up"+ postMessage["info"]["ProductId"])
                    cp.style.backgroundColor = "green"
                    var borderTime = setTimeout(function() {
                        cp.style.backgroundColor = ""
                        return clearTimeout(borderTime)
                    }, 3000)

                    // window.location = host.origin + "/#up" + postMessage["info"]["ProductId"]
                    window.location = window.location.origin + "/#up" + postMessage["info"]["ProductId"]
                    return
                }

                console.log(postMessage)
                return html.closeLoading()
            })

            // delete data product
            ajax.xmlDelete.addEventListener("load", function() {
                var response = utils.parseToJSON(this.responseText)
                console.log(response)
                if (!response) return alert(this.responseText)
                var product = utils.qs("#up" + response["ProductId"])
                if (!product) return alert("product not found")
                return product.remove()
            })
        
            // logout
            html.btnLogout1.addEventListener("click", function () {
                ajax.logout()
            })

            html.btnLogout2.addEventListener("click", function () {
                ajax.logout()
            })

            ajax.xmlLogout.addEventListener("load", function() {
                var message = utils.parseToJSON(this.responseText)
                if (!message) {
                    return
                }

                console.log(message)
                window.location.reload()
            })
        </script>

        <!-- REQUIRED SCRIPTS -->
        <script src="{{.host_static}}/static/plugins/jquery/jquery.min.js"></script>
        <script src="{{.host_static}}/static/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="{{.host_static}}/static/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
        <script src="{{.host_static}}/static/dist/js/adminlte.min.js"></script>

        <!-- PLUGIN SCRIPTS -->
    </body>
</html>
